<!DOCTYPE html>
<html>
<head>
    <title>PageDown Demo Page</title>
    <link rel="stylesheet" type="text/css" href="stylesheets/demo.css" />
    <link rel="stylesheet" type="text/css" href="stylesheets/bootstrap.min.css" />
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="javascript/Markdown.Converter.js"></script>
    <script type="text/javascript" src="javascript/Markdown.Sanitizer.js"></script>
    <script type="text/javascript" src="javascript/Markdown.Editor.js"></script>
</head>

<body>
<div class="container">
    <h1>Markdown Table of Contents Generator</h1>
    <p>Auto-generate a table of contents for better-organized readmes!</p>
    <div class="wmd-panel row">
    <div id="wmd-button-bar"></div>
        <div class="span6">
            <textarea rows="8" class="wmd-input input-block-level" id="wmd-input">Paste Mardown here</textarea>
        </div>
        <div class="span6">
            <div id="wmd-preview" class="wmd-panel wmd-preview"></div>
            <textarea rows="8" id="output" class="input-block-level"></textarea>
        </div>
        
</div>

</div>
<script type="text/javascript">
    (function () {

        var createToc = function(){
            var headers = [];
            $("#wmd-preview h1, #wmd-preview h2, #wmd-preview h3").each(function(){
                headers.push($(this));
            });

            for (i = headers.length+-1; i >= 0; i--) {
              var linkInside = $(headers[i]).text();
              var linkLink = $(headers[i]).attr("id");
              var full = i+1 + ". [" + linkInside + "](#" + linkLink + ")\n";
              $("#output").prepend(full);
            }
        }

        var createOutput = function() {
            var copy = $("#wmd-preview").html();
            $("#output").html(copy);
        }

        var converter1 = Markdown.getSanitizingConverter();
        var editor1 = new Markdown.Editor(converter1);
        editor1.run();
        editor1.hooks.chain("onPreviewRefresh", function () {
           createOutput();
           createToc();
        });

    })();
</script>
</body>
</html>
